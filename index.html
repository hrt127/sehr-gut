<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Communication Assistant</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { Send, MessageSquare, Volume2, Copy, Check, Languages, Mic, Globe, ArrowRight, Sparkles } = (() => {
            const iconProps = { xmlns: "http://www.w3.org/2000/svg", width: 24, height: 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round" };
            return {
                Send: (props) => <svg {...iconProps} {...props}><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>,
                MessageSquare: (props) => <svg {...iconProps} {...props}><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>,
                Volume2: (props) => <svg {...iconProps} {...props}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></svg>,
                Copy: (props) => <svg {...iconProps} {...props}><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>,
                Check: (props) => <svg {...iconProps} {...props}><path d="M20 6 9 17l-5-5"/></svg>,
                Languages: (props) => <svg {...iconProps} {...props}><path d="m5 8 6 6"/><path d="m4 14 6-6 2-3"/><path d="M2 5h12"/><path d="M7 2h1"/><path d="m22 22-5-10-5 10"/><path d="M14 18h6"/></svg>,
                Mic: (props) => <svg {...iconProps} {...props}><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" x2="12" y1="19" y2="22"/></svg>,
                Globe: (props) => <svg {...iconProps} {...props}><circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/><path d="M2 12h20"/></svg>,
                ArrowRight: (props) => <svg {...iconProps} {...props}><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>,
                Sparkles: (props) => <svg {...iconProps} {...props}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M19 17v4"/><path d="M3 5h4"/><path d="M17 19h4"/></svg>
            };
        })();

        const TRANSLATIONS = {
            "en-US": {
                "title": "Communication Assistant",
                "quickTranslate": "Quick Translate",
                "translateInto": "Translate into",
                "yourMessage": "What do you want to say?",
                "translate": "Translate",
                "conversationMode": "Conversation Mode",
                "needHelp": "Need help saying something?",
                "typeInEnglish": "Type in English what you want to say:",
                "getHelp": "Get help with:",
                "askQuestion": "Ask me anything about the language or culture",
                "helpPlaceholder": "How do I say...? What does... mean? Is it polite to...?",
                "copied": "Copied!",
                "copy": "Copy",
                "recentTranslations": "Recent Translations",
                "conversationHistory": "Conversation History",
                "clear": "Clear",
                "suggestion": "Suggested",
                "cultural": "Cultural Tip",
                "pronunciation": "Pronunciation"
            }
        };

        const locale = 'en-US';
        const t = (key) => TRANSLATIONS[locale]?.[key] || TRANSLATIONS['en-US'][key] || key;

        const CommunicationAssistant = () => {
            const [selectedLanguage, setSelectedLanguage] = useState('german');
            const [inputText, setInputText] = useState('');
            const [helpText, setHelpText] = useState('');
            const [translations, setTranslations] = useState([]);
            const [isTranslating, setIsTranslating] = useState(false);
            const [isGettingHelp, setIsGettingHelp] = useState(false);
            const [copiedId, setCopiedId] = useState(null);
            const [activeTab, setActiveTab] = useState('translate');
            const messagesEndRef = useRef(null);

            const languages = {
                german: { name: 'German (Deutsch)', flag: 'üá©üá™', nativeName: 'Deutsch' },
                spanish: { name: 'Spanish (Espa√±ol)', flag: 'üá™üá∏', nativeName: 'Espa√±ol' },
                french: { name: 'French (Fran√ßais)', flag: 'üá´üá∑', nativeName: 'Fran√ßais' },
                italian: { name: 'Italian (Italiano)', flag: 'üáÆüáπ', nativeName: 'Italiano' },
                portuguese: { name: 'Portuguese (Portugu√™s)', flag: 'üáµüáπ', nativeName: 'Portugu√™s' },
                japanese: { name: 'Japanese (Êó•Êú¨Ë™û)', flag: 'üáØüáµ', nativeName: 'Êó•Êú¨Ë™û' },
                chinese: { name: 'Chinese (‰∏≠Êñá)', flag: 'üá®üá≥', nativeName: '‰∏≠Êñá' },
                korean: { name: 'Korean (ÌïúÍµ≠Ïñ¥)', flag: 'üá∞üá∑', nativeName: 'ÌïúÍµ≠Ïñ¥' },
                dutch: { name: 'Dutch (Nederlands)', flag: 'üá≥üá±', nativeName: 'Nederlands' },
                russian: { name: 'Russian (–†—É—Å—Å–∫–∏–π)', flag: 'üá∑üá∫', nativeName: '–†—É—Å—Å–∫–∏–π' },
                arabic: { name: 'Arabic (ÿßŸÑÿπÿ±ÿ®Ÿäÿ©)', flag: 'üá∏üá¶', nativeName: 'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©' },
                hindi: { name: 'Hindi (‡§π‡§ø‡§®‡•ç‡§¶‡•Ä)', flag: 'üáÆüá≥', nativeName: '‡§π‡§ø‡§®‡•ç‡§¶‡•Ä' }
            };

            const quickPhrases = {
                german: [
                    "Hello, nice to meet you",
                    "How are you?",
                    "Thank you very much",
                    "I don't understand",
                    "Can you help me?",
                    "Where is the bathroom?",
                    "How much does this cost?",
                    "I'm sorry",
                    "Goodbye"
                ]
            };

            useEffect(() => {
                scrollToBottom();
            }, [translations]);

            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            };

            const handleTranslate = async () => {
                if (!inputText.trim() || isTranslating) return;

                setIsTranslating(true);

                try {
                    const prompt = `You are a practical translation assistant helping someone communicate with people of different backgrounds.

User wants to say: "${inputText}"
Target language: ${languages[selectedLanguage].name}

Provide a JSON response with this exact format:
{
  "translation": "The natural, conversational translation in ${languages[selectedLanguage].name}",
  "pronunciation": "Simple phonetic guide for English speakers",
  "formalVersion": "A more formal/polite version if significantly different",
  "informalVersion": "A more casual version if appropriate",
  "culturalNote": "Brief note about when/how to use this (1-2 sentences max)",
  "alternatives": ["Alternative way 1", "Alternative way 2"]
}

IMPORTANT: Make translations practical and natural. Focus on what real people actually say. Keep cultural notes brief and directly useful.

Your entire response MUST be valid JSON only. DO NOT include any text outside the JSON structure.`;

                    const response = await fetch("https://api.anthropic.com/v1/messages", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            model: "claude-sonnet-4-20250514",
                            max_tokens: 1000,
                            messages: [{ role: "user", content: prompt }]
                        })
                    });

                    const data = await response.json();
                    let responseText = data.content[0].text.replace(/```json\n?/g, "").replace(/```\n?/g, "").trim();
                    const parsedResponse = JSON.parse(responseText);

                    const newTranslation = {
                        id: Date.now(),
                        original: inputText,
                        ...parsedResponse,
                        timestamp: new Date()
                    };

                    setTranslations(prev => [newTranslation, ...prev]);
                    setInputText('');

                } catch (error) {
                    console.error('Translation error:', error);
                    const errorTranslation = {
                        id: Date.now(),
                        original: inputText,
                        translation: "Sorry, I couldn't translate that right now. Please try again.",
                        timestamp: new Date()
                    };
                    setTranslations(prev => [errorTranslation, ...prev]);
                } finally {
                    setIsTranslating(false);
                }
            };

            const handleGetHelp = async () => {
                if (!helpText.trim() || isGettingHelp) return;

                setIsGettingHelp(true);

                try {
                    const prompt = `You are a practical language assistant. Someone is trying to communicate in ${languages[selectedLanguage].name} and needs immediate, actionable help.

Their question: "${helpText}"
Target language: ${languages[selectedLanguage].name}

Provide a JSON response with this exact format:
{
  "answer": "Direct, concise answer to their question",
  "example": "A practical example they can use immediately",
  "pronunciation": "Simple phonetic guide if relevant",
  "tip": "One brief, useful tip related to their question"
}

IMPORTANT: 
- Be concise and practical
- Focus on what they can use RIGHT NOW in a conversation
- Skip formalities and get straight to the point
- If they ask "how do I say X", give them the translation immediately
- If they ask about culture, be specific and practical, not academic

Your entire response MUST be valid JSON only. DO NOT include any text outside the JSON structure.`;

                    const response = await fetch("https://api.anthropic.com/v1/messages", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            model: "claude-sonnet-4-20250514",
                            max_tokens: 800,
                            messages: [{ role: "user", content: prompt }]
                        })
                    });

                    const data = await response.json();
                    let responseText = data.content[0].text.replace(/```json\n?/g, "").replace(/```\n?/g, "").trim();
                    const parsedResponse = JSON.parse(responseText);

                    const helpResponse = {
                        id: Date.now(),
                        original: helpText,
                        type: 'help',
                        ...parsedResponse,
                        timestamp: new Date()
                    };

                    setTranslations(prev => [helpResponse, ...prev]);
                    setHelpText('');

                } catch (error) {
                    console.error('Help error:', error);
                } finally {
                    setIsGettingHelp(false);
                }
            };

            const quickTranslate = async (phrase) => {
                setInputText(phrase);
                setTimeout(() => handleTranslate(), 100);
            };

            const copyToClipboard = (text, id) => {
                navigator.clipboard.writeText(text);
                setCopiedId(id);
                setTimeout(() => setCopiedId(null), 2000);
            };

            const clearHistory = () => {
                setTranslations([]);
            };

            return (
                <div className="flex h-screen bg-gradient-to-br from-gray-50 to-gray-100">
                    <div className="flex-1 flex flex-col">
                        <div className="bg-white border-b border-gray-200 shadow-sm">
                            <div className="p-4">
                                <div className="flex items-center justify-between mb-4">
                                    <div className="flex items-center space-x-3">
                                        <div className="bg-blue-600 p-2 rounded-lg">
                                            <Globe className="h-6 w-6 text-white" />
                                        </div>
                                        <div>
                                            <h1 className="text-xl font-bold text-gray-800">{t('title')}</h1>
                                            <p className="text-sm text-gray-500">Real-time help when you need it</p>
                                        </div>
                                    </div>
                                    
                                    <select 
                                        value={selectedLanguage}
                                        onChange={(e) => setSelectedLanguage(e.target.value)}
                                        className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-lg"
                                    >
                                        {Object.entries(languages).map(([code, lang]) => (
                                            <option key={code} value={code}>
                                                {lang.flag} {lang.nativeName}
                                            </option>
                                        ))}
                                    </select>
                                </div>

                                <div className="flex space-x-2 border-b border-gray-200">
                                    <button
                                        onClick={() => setActiveTab('translate')}
                                        className={`px-4 py-2 font-medium text-sm border-b-2 transition-colors ${
                                            activeTab === 'translate'
                                                ? 'border-blue-600 text-blue-600'
                                                : 'border-transparent text-gray-500 hover:text-gray-700'
                                        }`}
                                    >
                                        <Languages className="h-4 w-4 inline mr-1" />
                                        {t('quickTranslate')}
                                    </button>
                                    <button
                                        onClick={() => setActiveTab('help')}
                                        className={`px-4 py-2 font-medium text-sm border-b-2 transition-colors ${
                                            activeTab === 'help'
                                                ? 'border-blue-600 text-blue-600'
                                                : 'border-transparent text-gray-500 hover:text-gray-700'
                                        }`}
                                    >
                                        <Sparkles className="h-4 w-4 inline mr-1" />
                                        Get Help
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div className="bg-white border-b border-gray-200 p-4">
                            {activeTab === 'translate' ? (
                                <div>
                                    <label className="text-sm font-medium text-gray-700 mb-2 block">
                                        {t('yourMessage')}
                                    </label>
                                    <div className="flex space-x-2">
                                        <input
                                            type="text"
                                            value={inputText}
                                            onChange={(e) => setInputText(e.target.value)}
                                            onKeyPress={(e) => e.key === 'Enter' && handleTranslate()}
                                            placeholder="Type in English..."
                                            className="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-lg"
                                            disabled={isTranslating}
                                        />
                                        <button
                                            onClick={handleTranslate}
                                            disabled={isTranslating || !inputText.trim()}
                                            className="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium"
                                        >
                                            {isTranslating ? 'Translating...' : t('translate')}
                                        </button>
                                    </div>
                                </div>
                            ) : (
                                <div>
                                    <label className="text-sm font-medium text-gray-700 mb-2 block">
                                        {t('askQuestion')}
                                    </label>
                                    <div className="flex space-x-2">
                                        <input
                                            type="text"
                                            value={helpText}
                                            onChange={(e) => setHelpText(e.target.value)}
                                            onKeyPress={(e) => e.key === 'Enter' && handleGetHelp()}
                                            placeholder={t('helpPlaceholder')}
                                            className="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-lg"
                                            disabled={isGettingHelp}
                                        />
                                        <button
                                            onClick={handleGetHelp}
                                            disabled={isGettingHelp || !helpText.trim()}
                                            className="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium"
                                        >
                                            {isGettingHelp ? 'Getting Help...' : 'Ask'}
                                        </button>
                                    </div>
                                </div>
                            )}
                        </div>

                        <div className="flex-1 overflow-y-auto p-4 space-y-4">
                            {translations.length === 0 && (
                                <div className="text-center py-12">
                                    <div className="text-6xl mb-4">{languages[selectedLanguage].flag}</div>
                                    <h2 className="text-xl font-semibold text-gray-700 mb-2">
                                        Ready to help you communicate in {languages[selectedLanguage].nativeName}
                                    </h2>
                                    <p className="text-gray-500 mb-6">
                                        Translate what you want to say or ask me anything about the language
                                    </p>
                                    {quickPhrases[selectedLanguage] && (
                                        <div className="max-w-2xl mx-auto">
                                            <p className="text-sm font-medium text-gray-600 mb-3">Common phrases you might need:</p>
                                            <div className="flex flex-wrap gap-2 justify-center">
                                                {quickPhrases[selectedLanguage].map((phrase, idx) => (
                                                    <button
                                                        key={idx}
                                                        onClick={() => quickTranslate(phrase)}
                                                        className="px-3 py-1 bg-gray-200 hover:bg-blue-100 text-gray-700 hover:text-blue-700 rounded-full text-sm transition-colors"
                                                    >
                                                        {phrase}
                                                    </button>
                                                ))}
                                            </div>
                                        </div>
                                    )}
                                </div>
                            )}

                            {translations.map((item) => (
                                <div key={item.id} className="bg-white rounded-lg shadow-sm border border-gray-200 p-4">
                                    {item.type === 'help' ? (
                                        <div>
                                            <div className="flex items-start justify-between mb-3">
                                                <div className="flex-1">
                                                    <p className="text-sm text-gray-500 mb-1">You asked:</p>
                                                    <p className="text-lg font-medium text-gray-800">{item.original}</p>
                                                </div>
                                            </div>
                                            
                                            <div className="bg-blue-50 border-l-4 border-blue-600 p-3 mb-3">
                                                <p className="text-gray-800">{item.answer}</p>
                                            </div>

                                            {item.example && (
                                                <div className="bg-green-50 rounded-lg p-3 mb-3">
                                                    <p className="text-xs font-medium text-green-700 mb-1">Example:</p>
                                                    <p className="text-lg font-medium text-green-900">{item.example}</p>
                                                    {item.pronunciation && (
                                                        <p className="text-sm text-green-700 mt-1 italic">{item.pronunciation}</p>
                                                    )}
                                                </div>
                                            )}

                                            {item.tip && (
                                                <div className="bg-yellow-50 rounded-lg p-3">
                                                    <p className="text-xs font-medium text-yellow-700 mb-1">üí° Tip:</p>
                                                    <p className="text-sm text-yellow-900">{item.tip}</p>
                                                </div>
                                            )}
                                        </div>
                                    ) : (
                                        <div>
                                            <div className="flex items-start justify-between mb-3">
                                                <div className="flex-1">
                                                    <p className="text-sm text-gray-500 mb-1">You want to say:</p>
                                                    <p className="text-base text-gray-700">{item.original}</p>
                                                </div>
                                                <button
                                                    onClick={() => copyToClipboard(item.translation, item.id)}
                                                    className="ml-2 p-2 hover:bg-gray-100 rounded-lg transition-colors"
                                                    title="Copy translation"
                                                >
                                                    {copiedId === item.id ? (
                                                        <Check className="h-4 w-4 text-green-600" />
                                                    ) : (
                                                        <Copy className="h-4 w-4 text-gray-400" />
                                                    )}
                                                </button>
                                            </div>

                                            <div className="bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg p-4 mb-3">
                                                <div className="flex items-start justify-between">
                                                    <div className="flex-1">
                                                        <p className="text-2xl font-bold text-blue-900 mb-2">{item.translation}</p>
                                                        {item.pronunciation && (
                                                            <p className="text-sm text-blue-700 italic">üó£Ô∏è {item.pronunciation}</p>
                                                        )}
                                                    </div>
                                                    <div className="text-3xl">{languages[selectedLanguage].flag}</div>
                                                </div>
                                            </div>

                                            {item.culturalNote && (
                                                <div className="bg-purple-50 rounded-lg p-3 mb-2">
                                                    <p className="text-xs font-medium text-purple-700 mb-1">Cultural Note:</p>
                                                    <p className="text-sm text-purple-900">{item.culturalNote}</p>
                                                </div>
                                            )}

                                            {(item.formalVersion || item.informalVersion) && (
                                                <div className="grid grid-cols-2 gap-2 mb-2">
                                                    {item.formalVersion && (
                                                        <div className="bg-gray-50 rounded-lg p-2">
                                                            <p className="text-xs text-gray-600 mb-1">Formal:</p>
                                                            <p className="text-sm font-medium text-gray-800">{item.formalVersion}</p>
                                                        </div>
                                                    )}
                                                    {item.informalVersion && (
                                                        <div className="bg-gray-50 rounded-lg p-2">
                                                            <p className="text-xs text-gray-600 mb-1">Casual:</p>
                                                            <p className="text-sm font-medium text-gray-800">{item.informalVersion}</p>
                                                        </div>
                                                    )}
                                                </div>
                                            )}

                                            {item.alternatives && item.alternatives.length > 0 && (
                                                <div className="border-t border-gray-200 pt-2 mt-2">
                                                    <p className="text-xs text-gray-600 mb-2">Other ways to say it:</p>
                                                    <div className="flex flex-wrap gap-2">
                                                        {item.alternatives.map((alt, idx) => (
                                                            <button
                                                                key={idx}
                                                                onClick={() => copyToClipboard(alt, `${item.id}-alt-${idx}`)}
                                                                className="px-3 py-1 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-full text-sm transition-colors"
                                                            >
                                                                {alt}
                                                            </button>
                                                        ))}
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    )}
                                </div>
                            ))}
                            <div ref={messagesEndRef} />
                        </div>
                    </div>

                    <div className="w-80 bg-white border-l border-gray-200 flex flex-col">
                        <div className="p-4 border-b border-gray-200">
                            <div className="flex items-center justify-between mb-3">
                                <h3 className="font-semibold text-gray-800">History</h3>
                                {translations.length > 0 && (
                                    <button
                                        onClick={clearHistory}
                                        className="text-sm text-red-600 hover:text-red-700"
                                    >
                                        {t('clear')}
                                    </button>
                                )}
                            </div>
                        </div>

                        <div className="flex-1 overflow-y-auto p-4">
                            {translations.length === 0 ? (
                                <p className="text-sm text-gray-500 text-center py-8">
                                    Your translations and questions will appear here
                                </p>
                            ) : (
                                <div className="space-y-2">
                                    {translations.slice(0, 10).map((item) => (
                                        <div
                                            key={item.id}
                                            className="p-3 bg-gray-50 hover:bg-gray-100 rounded-lg cursor-pointer transition-colors"
                                            onClick={() => {
                                                if (item.type === 'help') {
                                                    setHelpText(item.original);
                                                    setActiveTab('help');
                                                } else {
                                                    setInputText(item.original);
                                                    setActiveTab('translate');
                                                }
                                            }}
                                        >
                                            <p className="text-xs text-gray-500 mb-1">
                                                {item.timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                                            </p>
                                            <p className="text-sm text-gray-700 truncate">{item.original}</p>
                                            <p className="text-sm font-medium text-blue-600 truncate mt-1">
                                                {item.translation || item.answer}
                                            </p>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>

                        <div className="p-4 border-t border-gray-200 bg-gray-50">
                            <p className="text-xs text-gray-600 text-center">
                                Speaking with someone in {languages[selectedLanguage].nativeName}
                            </p>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<CommunicationAssistant />, document.getElementById('root'));
    </script>
</body>
</html>
